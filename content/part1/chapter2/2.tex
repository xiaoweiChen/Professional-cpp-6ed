
C++20ä¹‹å‰ï¼Œå­—ç¬¦ä¸²çš„æ ¼å¼åŒ–é€šå¸¸æ˜¯ç”¨Cé£æ ¼çš„å‡½æ•°(å¦‚printf())æˆ–C++ I/Oæµ(å¦‚std::cout)å®Œæˆã€‚

\begin{itemize}
\item
Cé£æ ¼çš„å‡½æ•°:

\begin{itemize}
\item
ä¸æ¨èä½¿ç”¨ï¼Œç±»å‹ä¸å®‰å…¨ï¼Œå¹¶ä¸”ä¸èƒ½æ‰©å±•æ”¯æŒè‡ªå®šä¹‰ç±»å‹

\item
æ˜“äºé˜…è¯»ï¼Œå› ä¸ºæ ¼å¼å­—ç¬¦ä¸²å’Œå‚æ•°çš„åˆ†ç¦»ï¼Œå®¹æ˜“ç¿»è¯‘æˆä¸åŒçš„è¯­è¨€

\item
ä¾‹å¦‚:
\begin{cpp}
printf("x has value %d and y has value %d.\n", x, y);
\end{cpp}
\end{itemize}

\item
C++ I/Oæµ:

\begin{itemize}
\item
æ¨è(C++20ä¹‹å‰)ï¼Œç±»å‹å®‰å…¨ä¸”å¯æ‰©å±•

\item
æ›´éš¾é˜…è¯»ï¼Œå­—ç¬¦ä¸²å’Œå‚æ•°æ˜¯äº¤ç»‡åœ¨ä¸€èµ·çš„ï¼Œå¾ˆéš¾ç†è§£

\item
ä¾‹å¦‚:
\begin{cpp}
cout << "x has value " << x << " and y has value " << y << '.' << endl;
\end{cpp}
\end{itemize}

\end{itemize}

C++20å¼•å…¥äº†<format>å¤´æ–‡ä»¶ï¼Œå…¶ä¸­å®šä¹‰çš„std::format()æ¥æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œç»“åˆäº†Cé£æ ¼å‡½æ•°å’ŒC++ I/Oæµçš„æ‰€æœ‰ä¼˜ç‚¹ï¼Œæ˜¯ä¸€ç§ç±»å‹å®‰å…¨ä¸”å¯æ‰©å±•çš„æ ¼å¼åŒ–æœºåˆ¶:

\begin{cpp}
cout << format("x has value {} and y has value {}.", x, y) << endl;
\end{cpp}

C++23å¼•å…¥äº†std::print()å’Œprintln():

\begin{cpp}
println("x has value {} and y has value {}.", x, y);
\end{cpp}

æ­¤å¤–ï¼Œstd::print()å’Œprintln()æ›´å¥½åœ°æ”¯æŒå°†UTF-8 Unicodeæ–‡æœ¬å†™å…¥Unicodeå…¼å®¹çš„æ§åˆ¶å°:

\begin{cpp}
println("ã“ã‚“ã«ã¡ã¯ä¸–ç•Œ");
\end{cpp}

è¿™å°†æ­£ç¡®åœ°å°†å­—ç¬¦ä¸²â€œã“ã‚“ã«ã¡ã¯ä¸–ç•Œâ€(æ—¥è¯­ä¸­è¡¨ç¤ºâ€œHello Worldâ€)æ‰“å°åˆ°æ§åˆ¶å°(è¦ç¼–è¯‘åŒ…å«Unicodeå­—ç¬¦çš„æºä»£ç ï¼Œéœ€è¦ä¼ é€’ç¼–è¯‘å™¨é€‰é¡¹)ã€‚å¯¹äºVisual C++ï¼Œå¿…é¡»ä¼ é€’/utf-8ç¼–è¯‘å™¨é€‰é¡¹ã€‚å¯¹äºGCCï¼Œä½¿ç”¨å‘½ä»¤è¡Œé€‰é¡¹-finputcharset=UTF-8ã€‚Clangå‡å®šæ‰€æœ‰æ–‡ä»¶é»˜è®¤éƒ½æ˜¯UTF-8æ ¼å¼)è‹¥å°è¯•ä½¿ç”¨C++ I/Oæµè¾“å‡ºè¿™ä¸ªå­—ç¬¦ä¸²ï¼Œæ ¹æ®æ§åˆ¶å°è®¾ç½®ï¼Œè¾“å‡ºå¯èƒ½ä¼šæ˜¯ä¸€äº›ä¹±ç ï¼Œä¾‹å¦‚â€œÏ€Ã¼Ã´Ï€Ã©Ã´Ï€Ã¼Â½Ï€Ã¼Ã­Ï€Ã¼Â»Î£â••Ã»Ï„Ã²Ã®â€:

\begin{cpp}
cout << "ã“ã‚“ã«ã¡ã¯ä¸–ç•Œ" << endl;
\end{cpp}

ç”±äºæ”¯æŒUnicodeï¼Œç”šè‡³å¯ä»¥æ‰“å°è¡¨æƒ…ç¬¦å·ã€‚è‹¥è¾“æ§åˆ¶å°å¯ä»¥æ­£ç¡®æ”¯æŒUnicodeï¼Œä¸‹é¢çš„ä»£ç å°†æ‰“å°ä¸€ä¸ªç¬‘è„¸ç¬¦å·ã€‚å¯¹æ­¤ä½¿ç”¨coutå¯èƒ½ä¼šè¾“å‡ºä¹±ç ã€‚

\newfontfamily\emojifont{Segoe UI Emoji}
println("{\emojifont ğŸ˜Š}");

std::print()å’Œprintln()æ˜¯å‘æ§åˆ¶å°å†™å…¥æ–‡æœ¬çš„æ¨èæ–¹å¼ï¼Œæœ¬ä¹¦ä¸­çš„æ‰€æœ‰ç¤ºä¾‹éƒ½ä½¿ç”¨äº†å®ƒä»¬ã€‚å®ƒä»¬æ˜¯ç±»å‹å®‰å…¨çš„ï¼Œå¯æ‰©å±•ä»¥æ”¯æŒè‡ªå®šä¹‰ç±»å‹ï¼Œæ˜“äºé˜…è¯»ï¼Œæ”¯æŒUnicodeè¾“å‡ºï¼Œæ”¯æŒä¸åŒè¯­è¨€çš„æœ¬åœ°åŒ–ç­‰ã€‚é™¤äº†è¿™äº›å¥½å¤„ä¹‹å¤–ï¼Œprint()å’Œprintln()çš„æ€§èƒ½ä¹Ÿæ¯”ç›´æ¥ä½¿ç”¨C++ I/Oæµè¦å¥½å¾—å¤šï¼Œprint()å’Œprintln()åœ¨åº•å±‚ä»ç„¶ä½¿ç”¨æµã€‚

\mySubsubsection{2.2.1.}{æ ¼å¼åŒ–å­—ç¬¦ä¸²}

std::format()ã€print()å’Œprintln()ä½¿ç”¨æ ¼å¼å­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²æŒ‡å®šåœ¨è¾“å‡ºå­—ç¬¦ä¸²ä¸­å¿…é¡»å¦‚ä½•æ ¼å¼åŒ–ç»™å®šå‚æ•°ã€‚åŸºæœ¬å½¢å¼åœ¨å‰é¢ä»‹ç»è¿‡ï¼Œå¹¶ä¸”åœ¨ç¤ºä¾‹ä¸­ä½¿ç”¨è¿‡ï¼Œæ˜¯æ—¶å€™çœ‹çœ‹è¿™äº›æ ¼å¼å­—ç¬¦ä¸²æœ‰å¤šå¼ºå¤§äº†ã€‚

æ ¼å¼å­—ç¬¦ä¸²é€šå¸¸æ˜¯format()ã€print()å’Œprintln()çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚æ ¼å¼å­—ç¬¦ä¸²å¯ä»¥åŒ…å«ä¸€ç»„èŠ±æ‹¬å·\{\}ï¼Œè¡¨ç¤ºæ›¿æ¢å­—æ®µï¼Œå¯ä»¥æ ¹æ®éœ€è¦æ›¿æ¢çš„å­—æ®µã€‚format()ã€print()å’Œprintln()çš„åç»­å‚æ•°æ˜¯ç”¨äºå¡«å……è¿™äº›æ›¿æ¢å­—æ®µçš„å€¼ã€‚è‹¥åœ¨è¾“å‡ºä¸­éœ€è¦\{å’Œ\}å­—ç¬¦ï¼Œåˆ™éœ€è¦å°†å®ƒä»¬è½¬ä¹‰ä¸º\{\{æˆ–\}\}ã€‚

ç›®å‰ä¸ºæ­¢ï¼Œæ›¿æ¢å­—æ®µä¸€ç›´æ˜¯ç©ºçš„èŠ±æ‹¬å·\{\}ï¼Œè€Œè¿™ä»…ä»…æ˜¯ä¸ªå¼€å§‹ã€‚åœ¨è¿™äº›èŠ±æ‹¬å·å†…å¯ä»¥æ˜¯æ ¼å¼ä¸º[index][:specifier]çš„å­—ç¬¦ä¸²:

\begin{itemize}
\item
å¯é€‰ç´¢å¼•æ˜¯å‚æ•°ç´¢å¼•ï¼Œå°†åœ¨ä¸‹ä¸€èŠ‚è®¨è®ºã€‚

\item
å¯é€‰è¯´æ˜ç¬¦æ˜¯ä¸€ä¸ªæ ¼å¼è¯´æ˜ç¬¦ï¼Œç”¨äºè§„å®šåœ¨è¾“å‡ºä¸­å¿…é¡»å¦‚ä½•æ ¼å¼åŒ–å€¼ï¼Œä¼šåœ¨â€œæ ¼å¼è¯´æ˜ç¬¦â€ä¸€èŠ‚ä¸­è¯¦ç»†è¯´æ˜ã€‚
\end{itemize}

å¿…é¡»å‘format()ã€print()å’Œprintln()ä¼ é€’æ ¼å¼å­—ç¬¦ä¸²ï¼Œä¸èƒ½ç›´æ¥æ‰“å°å¦‚ä¸‹å€¼:

\begin{cpp}
int x { 42 };
println(x);
\end{cpp}

å¯ä»¥è¿™æ ·å†™:

\begin{cpp}
println("{}", x);
\end{cpp}

ä¹Ÿä¸èƒ½åªå†™ä¸‹é¢çš„ä»£ç ï¼Œä½¿å…¶æ‰“å°ä¸€ä¸ªæ¢è¡Œç¬¦:

\begin{cpp}
println();
\end{cpp}

è€Œéœ€è¦è¿™æ ·ä½¿ç”¨ï¼š

\begin{cpp}
println("");
\end{cpp}

\mySubsubsection{2.2.2.}{å‚æ•°ç´¢å¼•}

å¯ä»¥åœ¨æ‰€æœ‰æ›¿æ¢å­—æ®µä¸­çœç•¥ç´¢å¼•ï¼Œæˆ–è€…ä¸ºæ‰€æœ‰æ›¿æ¢å­—æ®µæŒ‡å®šä¼ é€’ç»™format()ã€print()æˆ–println()çš„ç¬¬äºŒä¸ªåŠåç»­å‚æ•°çš„ç´¢å¼•ï¼Œè¿™äº›å‚æ•°åº”è¯¥ç”¨äºæ›¿æ¢å­—æ®µã€‚è‹¥æƒ³è¦å¤šæ¬¡è¾“å‡ºæŸä¸ªå€¼ï¼Œå¯ä»¥å¤šæ¬¡ä½¿ç”¨æŸä¸ªç‰¹å®šçš„ç´¢å¼•ã€‚è‹¥çœç•¥äº†ç´¢å¼•ï¼Œåˆ™ä¼ é€’çš„ç¬¬äºŒä¸ªåŠåç»­å‚æ•°ï¼Œå°†æŒ‰ç»™å®šçš„é¡ºåºç”¨äºæ‰€æœ‰æ›¿æ¢å­—æ®µã€‚

ä¸‹é¢çš„ println() è°ƒç”¨çœç•¥äº†æ›¿æ¢å­—æ®µä¸­çš„æ˜¾å¼ç´¢å¼•ï¼š

\begin{cpp}
int n { 42 };
println("Read {} bytes from {}", n, "file1.txt");
\end{cpp}

å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼æŒ‡å®šæ‰‹åŠ¨ç´¢å¼•:

\begin{cpp}
println("Read {0} bytes from {1}", n, "file1.txt");
\end{cpp}

ä¸å…è®¸æ··åˆä½¿ç”¨æ‰‹åŠ¨ç´¢å¼•å’Œè‡ªåŠ¨ç´¢å¼•ã€‚ä¸‹é¢ä½¿ç”¨äº†ä¸€ä¸ªæ— æ•ˆçš„æ ¼å¼å­—ç¬¦ä¸²:

\begin{cpp}
println("Read {0} bytes from {}", n, "file1.txt");
\end{cpp}

å¯ä»¥æ›´æ”¹è¾“å‡ºå­—ç¬¦ä¸²ä¸­æ ¼å¼åŒ–å€¼çš„é¡ºåºï¼Œè€Œä¸å¿…æ›´æ”¹å‚æ•°çš„å®é™…é¡ºåºã€‚è‹¥æƒ³åœ¨è½¯ä»¶ä¸­ç¿»è¯‘å­—ç¬¦ä¸²ï¼Œè¿™æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„åŠŸèƒ½ã€‚æŸäº›è¯­è¨€åœ¨å¥å­ä¸­æœ‰ä¸åŒçš„è¯­åºã€‚ä¾‹å¦‚ï¼Œå‰é¢çš„æ ¼å¼å­—ç¬¦ä¸²å¯ä»¥ç¿»è¯‘ä¸ºä¸­æ–‡ã€‚ä¸­æ–‡ä¸­ï¼Œå¥å­ä¸­æ›¿æ¢å­—æ®µçš„é¡ºåºæ˜¯é¢ å€’çš„ï¼Œä½†ç”±äºåœ¨æ ¼å¼å­—ç¬¦ä¸²ä¸­ä½¿ç”¨äº†å‚æ•°ç´¢å¼•ï¼Œprintln()çš„å‚æ•°é¡ºåºå¯ä»¥ä¿æŒä¸å˜ã€‚

\begin{cpp}
println("ä»{1}ä¸­è¯»å–{0}ä¸ªå­—èŠ‚ã€‚ ", n, "file1.txt");
\end{cpp}

\mySubsubsection{2.2.3.}{è¾“å‡ºåˆ°ä¸åŒåœ°æ–¹}

ç›®å‰ä¸ºæ­¢ï¼Œæ¯æ¬¡è°ƒç”¨print()å’Œprintln()éƒ½æœ‰ä¸€ä¸ªæ ¼å¼å­—ç¬¦ä¸²ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåé¢è·Ÿç€ä¸€äº›é™„åŠ å‚æ•°:

\begin{cpp}
println("x has value {} and y has value {}.", x, y);
\end{cpp}

è¿™å°†å­—ç¬¦ä¸²æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºæµï¼Œå³ä¸std::coutç›¸åŒçš„æµã€‚

è¿˜æœ‰std::cerrï¼Œä¼ è¾“åˆ°æ ‡å‡†é”™è¯¯æ§åˆ¶å°ã€‚å¯ä»¥ä½¿ç”¨print()å’Œprintln()æ‰“å°åˆ°é”™è¯¯æ§åˆ¶å°:

\begin{cpp}
println(cerr, "x has value {} and y has value {}.", x, y);
\end{cpp}

\CXXTwentythreeLogo{-40}{-50}

\mySubsubsection{2.2.4.}{ç¼–è¯‘æ—¶éªŒè¯å­—ç¬¦ä¸²çš„æ ¼å¼}

ä»C++23èµ·ï¼Œformat()ã€print()ã€ å’Œprintln()çš„æ ¼å¼å­—ç¬¦ä¸²å¿…é¡»æ˜¯ç¼–è¯‘æ—¶å¸¸é‡ï¼Œè¿™æ ·ç¼–è¯‘å™¨å°±å¯ä»¥åœ¨ç¼–è¯‘æ—¶æ£€æŸ¥æ ¼å¼å­—ç¬¦ä¸²ä¸­æ˜¯å¦æœ‰è¯­æ³•é”™è¯¯ï¼Œæ‰€ä»¥ä»¥ä¸‹ä»£ç æ— æ³•ç¼–è¯‘ï¼š

\begin{cpp}
string s { "Hello World!" };
println(s); // Error! Does not compile
\end{cpp}

æ‰€äº§ç”Ÿçš„é”™è¯¯ä¾èµ–äºç¼–è¯‘å™¨ã€‚ä½†åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œå…¶æ ‡å‡†ç›¸å½“æ¨¡ç³Šï¼Œå¹¶ä¸æ€»æ˜¯æœ‰åŠ©äºç«‹å³ç¡®å®šé”™è¯¯çš„ç¡®åˆ‡åŸå› ã€‚ä»¥ä¸‹æ˜¯Microsoft Visual C++ 2022ç¼–è¯‘å™¨äº§ç”Ÿçš„é”™è¯¯:

\begin{shell}
error C7595: 'std::basic_format_string<char>::basic_format_string': call to immediate function is not a constant expression
\end{shell}

æ­£ç¡®ç”¨æ³•å¦‚ä¸‹:

\begin{cpp}
string s { "Hello World!" };
println("{}", s);
\end{cpp}

å› ä¸ºæ˜¯ç¼–è¯‘æ—¶å¸¸é‡ï¼Œæ‰€ä»¥å…è®¸ä½¿ç”¨constexpræ ¼å¼çš„å­—ç¬¦ä¸²ã€‚ç¬¬9ç« å°†è¯¦ç»†ä»‹ç»constexprå…³é”®å­—ã€‚

\begin{cpp}
constexpr auto formatString { "Value: {}" };
println(formatString, 11); // Value: 11
\end{cpp}

\mySamllsection{éç¼–è¯‘æ—¶å¸¸é‡æ ¼å¼å­—ç¬¦ä¸²}

å½“éœ€è¦ä¸ºä¸åŒçš„è¯­è¨€æœ¬åœ°åŒ–/ç¿»è¯‘æ ¼å¼å­—ç¬¦ä¸²æ—¶ï¼Œæ ¼å¼å­—ç¬¦ä¸²å¿…é¡»æ˜¯ç¼–è¯‘æ—¶å¸¸é‡å¯èƒ½æœ‰ç‚¹éº»çƒ¦ï¼Œå¯ä»¥ä½¿ç”¨std::vprint\_unicode()æˆ–std::vprint\_nonunicode()æ¥ä»£æ›¿std::print()ã€‚ä¸è¿‡ç”¨èµ·æ¥æœ‰ç‚¹éš¾ï¼Œä¸èƒ½åƒä½¿ç”¨print()é‚£æ ·åªä¼ é€’å‚æ•°ï¼Œè€Œæ˜¯éœ€è¦ä½¿ç”¨std::make\_format\_args()ååŠ©ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªä¾‹å­:

\begin{cpp}
enum class Language { English, Dutch };

string_view GetLocalizedFormat(Language language)
{
    switch (language) {
        case Language::English: return "Numbers: {0} and {1}.";
        case Language::Dutch: return "Getallen: {0} en {1}.";
    }
}

int main()
{
    Language language { Language::English };
    vprint_unicode(GetLocalizedFormat(language), make_format_args(1, 2));
    println("");
    language = Language::Dutch;
    vprint_unicode(GetLocalizedFormat(language), make_format_args(1, 2));
}
\end{cpp}

è¾“å‡ºä¸º:

\begin{shell}
Numbers: 1 and 2.
Getallen: 1 en 2.
\end{shell}

éœ€è¦ä¸€ä¸ªç¼–è¯‘æ—¶å¸¸é‡æ ¼å¼å­—ç¬¦ä¸²ï¼Œä¸‹é¢ä½¿ç”¨print()çš„ä»£ç ä¸èƒ½ç¼–è¯‘:

\begin{cpp}
print(GetLocalizedFormat(language), 1, 2);
\end{cpp}

\mySamllsection{å¤„ç†éç¼–è¯‘æ—¶å¸¸é‡æ ¼å¼å­—ç¬¦ä¸²ä¸­çš„é”™è¯¯}

åœ¨è¿è¡Œæ—¶æ—¶éªŒè¯æ ¼å¼å­—ç¬¦ä¸²æ—¶ï¼Œæ ¼å¼å­—ç¬¦ä¸²é”™è¯¯éƒ½ä¼šå¼•å‘std::format\_errorå¼‚å¸¸ã€‚std::format()ã€print()å’Œprintln()ç­‰å‡½æ•°æ°¸è¿œä¸ä¼šæŠ›å‡ºè¿™æ ·çš„å¼‚å¸¸ï¼Œå› ä¸ºæ ¼å¼å­—ç¬¦ä¸²éƒ½æ˜¯åœ¨ç¼–è¯‘æ—¶éªŒè¯çš„ã€‚ä½†åƒstd::vformat()å’Œvprint\_unicode()(å‚è§ä¸Šä¸€èŠ‚)è¿™æ ·çš„å‡½æ•°ä¸è¦æ±‚æ ¼å¼å­—ç¬¦ä¸²æ˜¯å¸¸é‡ï¼Œå› æ­¤åœ¨ç¼–è¯‘æ—¶ä¸è¿›è¡ŒéªŒè¯ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶éªŒè¯ï¼Œè¿™äº›å‡½æ•°å¯èƒ½æŠ›å‡ºformat\_errorå¼‚å¸¸:

\begin{cpp}
try {
    vprint_unicode("An integer: {5}", make_format_args(42));
} catch (const format_error& caught_exception) {
    println("{}", caught_exception.what()); // "Argument not found."
}
\end{cpp}

ç°åœ¨ï¼Œæ¥ç ”ç©¶ä¸€ä¸‹æ ¼å¼è¯´æ˜ç¬¦åˆ°åº•æœ‰å¤šå¼ºå¤§ã€‚

\mySubsubsection{2.2.5.}{æ ¼å¼è¯´æ˜ç¬¦}

å¦‚å‰æ‰€è¿°ï¼Œæ ¼å¼å­—ç¬¦ä¸²å¯ä»¥åŒ…å«ç”¨èŠ±æ‹¬å·åˆ†éš”çš„æ›¿æ¢å­—æ®µï¼Œè¿™äº›èŠ±æ‹¬å·å†…å¯ä»¥æ˜¯æ ¼å¼ä¸º[index][:specifier]çš„å­—ç¬¦ä¸²ã€‚æœ¬èŠ‚è®¨è®ºæ›¿æ¢å­—æ®µçš„æ ¼å¼è¯´æ˜ç¬¦éƒ¨åˆ†ã€‚

æ ¼å¼è¯´æ˜ç¬¦ç”¨äºæ“ä½œè¾“å‡ºä¸­å€¼çš„æ ¼å¼åŒ–æ–¹å¼ã€‚æ ¼å¼è¯´æ˜ç¬¦ä»¥å†’å·:ä½œä¸ºå‰ç¼€ã€‚æ ¼å¼è¯´æ˜ç¬¦çš„ä¸€èˆ¬å½¢å¼å¦‚ä¸‹:

\begin{shell}
[[fill]align][sign][#][0][width][.precision][L][type]
\end{shell}

æ–¹æ‹¬å·ä¹‹é—´çš„æ‰€æœ‰éƒ¨åˆ†éƒ½æ˜¯å¯é€‰çš„ï¼Œå„ä¸ªè¯´æ˜ç¬¦éƒ¨åˆ†å°†åœ¨ä¸‹ä¸€å°èŠ‚ä¸­è®¨è®ºã€‚

\mySamllsection{å®½åº¦}

å®½åº¦æŒ‡å®šåº”è¯¥å°†ç»™å®šå€¼æ ¼å¼åŒ–ä¸ºçš„å­—æ®µçš„æœ€å°å®½åº¦ã€‚

è¿™ä¹Ÿå¯ä»¥æ˜¯å¦ä¸€ç»„èŠ±æ‹¬å·ï¼Œç§°ä¸ºåŠ¨æ€å®½åº¦ã€‚è‹¥åœ¨èŠ±æ‹¬å·ä¸­æŒ‡å®šäº†ç´¢å¼•ï¼Œä¾‹å¦‚\{3\}ï¼Œåˆ™åŠ¨æ€å®½åº¦çš„å€¼å°†ä»å…·æœ‰ç»™å®šç´¢å¼•çš„å‚æ•°ä¸­è·å–ã€‚è‹¥æ²¡æœ‰æŒ‡å®šç´¢å¼•(å¦‚\{\})ï¼Œåˆ™ä»å‚æ•°åˆ—è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªå‚æ•°ä¸­è·å–å®½åº¦ã€‚

ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­:

\begin{cpp}
int i { 42 };
println("|{:5}|", i);        // |    42|
println("|{:{}}|", i, 7);    // |       42|
println("|{1:{0}}|", 7, i);  // |       42|
\end{cpp}


\mySamllsection{[fill]align}

[fill]alignéƒ¨åˆ†å¯é€‰åœ°è¯´æ˜è¦ä½¿ç”¨ä»€ä¹ˆå­—ç¬¦ä½œä¸ºå¡«å……å­—ç¬¦ï¼Œç„¶åæ˜¯å€¼åœ¨å…¶å­—æ®µä¸­åº”è¯¥å¦‚ä½•å¯¹é½:

\begin{itemize}
\item
< è¡¨ç¤ºå·¦å¯¹é½(é»˜è®¤ä¸ºéæ•´æ•°å’Œéæµ®ç‚¹æ•°)ã€‚

\item
> è¡¨ç¤ºå³å¯¹é½(é»˜è®¤ä¸ºæ•´æ•°å’Œæµ®ç‚¹æ•°)ã€‚

\item
\^{} è¡¨ç¤ºå±…ä¸­å¯¹é½ã€‚
\end{itemize}

å°†å¡«å……å­—ç¬¦æ’å…¥åˆ°è¾“å‡ºä¸­ï¼Œä»¥ç¡®ä¿è¾“å‡ºä¸­çš„å­—æ®µè¾¾åˆ°æŒ‡å®šç¬¦[width]éƒ¨åˆ†æŒ‡å®šçš„æ‰€éœ€æœ€å°å®½åº¦ã€‚è‹¥æ²¡æœ‰æŒ‡å®š[width]ï¼Œåˆ™[fill]alignä¸èµ·ä½œç”¨ã€‚

å½“ä½¿ç”¨å±…ä¸­å¯¹é½æ—¶ï¼Œåœ¨æ ¼å¼åŒ–å€¼çš„å·¦è¾¹å’Œå³è¾¹æœ‰ç›¸åŒæ•°é‡çš„å¡«å……å­—ç¬¦ã€‚è‹¥å¡«å……å­—ç¬¦æ€»æ•°ä¸ºå¥‡æ•°ï¼Œåˆ™åœ¨å³ä¾§æ·»åŠ é¢å¤–çš„å¡«å……å­—ç¬¦ã€‚

ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­:

\begin{cpp}
int i { 42 };
println("|{:7}|", i);     // |     42|
println("|{:<7}|", i);    // |42     |
println("|{:_>7}|", i);   // |_____42|
println("|{:_^7}|", i);   // |__42___|
\end{cpp}

ä¸‹é¢æ˜¯ä¸€ä¸ªæœ‰è¶£çš„æŠ€å·§ï¼Œå¯ä»¥è¾“å‡ºç‰¹å®šæ¬¡æ•°çš„å­—ç¬¦ã€‚ä¸éœ€è¦è‡ªå·±é”®å…¥åŒ…å«æ­£ç¡®å­—ç¬¦æ•°çš„å­—ç¬¦ä¸²å­—é¢å€¼ï¼Œè€Œæ˜¯åœ¨æ ¼å¼è¯´æ˜ç¬¦ä¸­æ˜¾å¼æŒ‡å®šæ‰€éœ€çš„å­—ç¬¦æ•°:

\begin{cpp}
println("|{:=>16}|", ""); // |================|
\end{cpp}

\mySamllsection{ç¬¦å·}

ç¬¦å·å¯ä»¥æ˜¯ä¸‹åˆ—å½¢å¼ä¹‹ä¸€:

\begin{itemize}
\item
- è¡¨ç¤ºä»…æ˜¾ç¤ºè´Ÿæ•°çš„ç¬¦å·(é»˜è®¤å€¼)ã€‚

\item
+ è¡¨ç¤ºæ˜¾ç¤ºè´Ÿæ•°å’Œæ­£æ•°çš„ç¬¦å·ã€‚

\item
ç©ºæ ¼è¡¨ç¤ºç€è´Ÿå·åº”è¯¥ç”¨åœ¨è´Ÿæ•°ä¸Šï¼Œç©ºæ ¼åº”è¯¥ç”¨åœ¨æ­£æ•°ä¸Šã€‚
\end{itemize}

ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­:

\begin{cpp}
int i { 42 };
println("|{:<5}|", i);   // |42  |
println("|{:<+5}|", i);  // |+42 |
println("|{:< 5}|", i);  // | 42 |
println("|{:< 5}|", -i); // |-42 |
\end{cpp}

\mySamllsection{\#}

\#éƒ¨åˆ†å¯ç”¨å¤‡ç”¨æ ¼å¼åŒ–è§„åˆ™ã€‚è‹¥å¯¹æ•´å‹å¯ç”¨äº†è¯¥åŠŸèƒ½ï¼Œå¹¶ä¸”è¿˜æŒ‡å®šäº†åå…­è¿›åˆ¶ã€äºŒè¿›åˆ¶æˆ–å…«è¿›åˆ¶æ•°å­—æ ¼å¼ï¼Œåˆ™æ›¿ä»£æ ¼å¼å°†åœ¨æ ¼å¼åŒ–çš„æ•°å­—å‰é¢æ’å…¥0xã€0xã€0bã€0bæˆ–0ã€‚è‹¥ä¸ºæµ®ç‚¹ç±»å‹å¯ç”¨ï¼Œåˆ™æ›¿ä»£æ ¼å¼å°†å§‹ç»ˆè¾“å‡ºä¸€ä¸ªå°æ•°åˆ†éš”ç¬¦ï¼Œå³ä½¿åé¢æ²¡æœ‰æ•°å­—ã€‚

ä¸‹é¢ä¸¤ä¸ªéƒ¨åˆ†ç»™å‡ºäº†å…¶ä»–æ ¼å¼çš„ç¤ºä¾‹ã€‚

\mySamllsection{ç±»å‹}

ç±»å‹æŒ‡å®šç»™å®šå€¼å¿…é¡»æ ¼å¼åŒ–çš„ç±»å‹ã€‚æœ‰å‡ ä¸ªé€‰é¡¹:

\begin{itemize}
\item
æ•´æ•°ç±»å‹:b(äºŒè¿›åˆ¶)ï¼Œb(äºŒè¿›åˆ¶ï¼Œå¦‚æœæŒ‡å®šäº†\#ï¼Œåˆ™ç”¨0Bä»£æ›¿0B)ï¼Œ d(åè¿›åˆ¶)ï¼Œo(å…«è¿›åˆ¶)ï¼Œx(åå…­è¿›åˆ¶ï¼Œå°å†™å­—æ¯a, b, c, d, e, f)ï¼Œ x(åå…­è¿›åˆ¶ï¼Œå¤§å†™å­—æ¯a, b, c, d, e, fï¼Œå¦‚æœæŒ‡å®šäº†\#ï¼Œåˆ™ç”¨0Xä»£æ›¿0X)ã€‚è‹¥ç±»å‹æœªæŒ‡å®šï¼Œåˆ™dç”¨äºæ•´å‹ã€‚

\item
æµ®ç‚¹ç±»å‹:æ”¯æŒä»¥ä¸‹æµ®ç‚¹æ ¼å¼ã€‚ç§‘å­¦æ ¼å¼ã€å›ºå®šæ ¼å¼ã€é€šç”¨æ ¼å¼å’Œåå…­è¿›åˆ¶æ ¼å¼çš„ç»“æœï¼Œä¸æœ¬ç« å‰é¢è®¨è®ºçš„std::chars\_format::scientificã€å›ºå®šæ ¼å¼ã€é€šç”¨æ ¼å¼å’Œåå…­è¿›åˆ¶æ ¼å¼çš„ç»“æœç›¸åŒã€‚

\begin{itemize}
\item
e, E: ä»¥å°å†™eæˆ–å¤§å†™eä½œä¸ºæŒ‡æ•°è¡¨ç¤ºçš„ç§‘å­¦è®°æ•°æ³•ï¼Œæ ¼å¼ä¸ºç»™å®šç²¾åº¦ï¼Œå¦‚æœæœªæŒ‡å®šç²¾åº¦åˆ™ä¸º6ã€‚

\item
f, F: å›ºå®šæ ¼å¼è¡¨ç¤ºæ³•ä¸ºç»™å®šç²¾åº¦æˆ–6(è‹¥æ²¡æœ‰æŒ‡å®šç²¾åº¦)ã€‚

\item
g, G: é€šç”¨è¡¨ç¤ºæ³•è‡ªåŠ¨é€‰æ‹©ä¸å¸¦æŒ‡æ•°(å›ºå®šæ ¼å¼)æˆ–å¸¦æŒ‡æ•°(å°å†™eæˆ–å¤§å†™e)çš„è¡¨ç¤ºï¼Œä½¿ç”¨ç»™å®šçš„ç²¾åº¦æˆ–6(è‹¥æ²¡æœ‰æŒ‡å®šç²¾åº¦)è¿›è¡Œæ ¼å¼åŒ–ã€‚

\item
a, A: ç”±å°å†™å­—æ¯(a)æˆ–å¤§å†™å­—æ¯(a)ç»„æˆçš„åå…­è¿›åˆ¶è¡¨ç¤ºæ³•

\item
è‹¥ç±»å‹æœªæŒ‡å®šï¼Œåˆ™gç”¨äºæµ®ç‚¹ç±»å‹ã€‚
\end{itemize}

\item
å¸ƒå°”å€¼:s(ä»¥æ–‡æœ¬å½¢å¼è¾“å‡ºçœŸæˆ–å‡)ï¼Œb, B, c, d, o, x, X(ä»¥æ•´æ•°å½¢å¼è¾“å‡º1æˆ–0)ã€‚è‹¥ç±»å‹æœªæŒ‡å®šï¼Œåˆ™sç”¨äºå¸ƒå°”ç±»å‹ã€‚

\item
å­—ç¬¦:c(å­—ç¬¦å¤åˆ¶åˆ°è¾“å‡º)ï¼Œ?(è½¬ä¹‰å­—ç¬¦å¤åˆ¶åˆ°è¾“å‡º)ï¼Œb, B, d, o, x, X(æ•´æ•°è¡¨ç¤º)ã€‚è‹¥ç±»å‹æœªæŒ‡å®šï¼Œåˆ™cç”¨äºå­—ç¬¦ç±»å‹ã€‚

\item
å­—ç¬¦ä¸²:s(å­—ç¬¦ä¸²å¤åˆ¶åˆ°è¾“å‡º)ï¼Œ?(è½¬ä¹‰å­—ç¬¦ä¸²å¤åˆ¶åˆ°è¾“å‡º)ã€‚è‹¥ç±»å‹æœªæŒ‡å®šï¼Œåˆ™sç”¨äºå­—ç¬¦ä¸²ç±»å‹ã€‚

\item
æŒ‡é’ˆ:p(ä»¥0xä¸ºå‰ç¼€çš„æŒ‡é’ˆçš„åå…­è¿›åˆ¶è¡¨ç¤ºæ³•)ã€‚è‹¥ç±»å‹æœªæŒ‡å®šï¼Œåˆ™pç”¨äºæŒ‡é’ˆç±»å‹ã€‚åªæœ‰void*ç±»å‹çš„æŒ‡é’ˆå¯ä»¥è¢«æ ¼å¼åŒ–ã€‚å…¶ä»–æŒ‡é’ˆç±»å‹å¿…é¡»é¦–å…ˆè½¬æ¢ä¸ºvoid*ç±»å‹ï¼Œä¾‹å¦‚ä½¿ç”¨static\_cast<void*>(myPointer)ã€‚
\end{itemize}

ä¸‹é¢æ˜¯ä¸€äº›æ•´å‹çš„ä¾‹å­:

\begin{cpp}
int i { 42 };
println("|{:10d}|", i);   // |        42|
println("|{:10b}|", i);   // |    101010|
println("|{:#10b}|", i);  // |  0b101010|
println("|{:10X}|", i);   // |        2A|
println("|{:#10X}|", i);  // |      0X2A|
\end{cpp}

ä¸‹é¢æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹çš„ä¾‹å­:

\begin{cpp}
string s { "ProCpp" };
println("|{:_^10}|", s); // |__ProCpp__|
\end{cpp}

å…³äºç²¾åº¦çš„ä¸‹ä¸€èŠ‚å°†ç»™å‡ºæµ®ç‚¹ç±»å‹çš„ç¤ºä¾‹ã€‚

\mySamllsection{ç²¾åº¦}

ç²¾åº¦åªèƒ½ç”¨äºæµ®ç‚¹å‹å’Œå­—ç¬¦ä¸²ç±»å‹ã€‚å…¶æŒ‡å®šä¸ºä¸€ä¸ªç‚¹ï¼Œåé¢è·Ÿç€è¦ä¸ºæµ®ç‚¹ç±»å‹è¾“å‡ºçš„åè¿›åˆ¶æ•°ï¼Œæˆ–è€…ä¸ºå­—ç¬¦ä¸²è¾“å‡ºçš„å­—ç¬¦æ•°ã€‚æµ®ç‚¹ç±»å‹çš„ä½æ•°åŒ…æ‹¬æ‰€æœ‰æ•°å­—ï¼ŒåŒ…æ‹¬å°æ•°ç‚¹åˆ†éš”ç¬¦ä¹‹å‰çš„æ•°å­—ï¼Œé™¤éä½¿ç”¨å›ºå®šæµ®ç‚¹è¡¨ç¤ºæ³•(å¯¹äºf)ï¼Œç²¾åº¦æ˜¯å°æ•°ç‚¹åçš„ä½æ•°ã€‚

ä¸å®½åº¦ä¸€æ ·ï¼Œç²¾åº¦ä¹Ÿå¯ä»¥æ˜¯å¦ä¸€ç»„èŠ±æ‹¬å·ï¼Œè¿™ç§°ä¸ºåŠ¨æ€ç²¾åº¦ã€‚ç²¾åº¦è¦ä¹ˆæ¥è‡ªå‚æ•°åˆ—è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªå‚æ•°ï¼Œè¦ä¹ˆæ¥è‡ªç»™å®šç´¢å¼•çš„å‚æ•°ã€‚

ä»¥ä¸‹æ˜¯ä¸€äº›ä½¿ç”¨æµ®ç‚¹ç±»å‹çš„ä¾‹å­ï¼š

\begin{cpp}
double d { 3.1415 / 2.3 };
println("|{:12g}|", d);   // |     1.36587|
println("|{:12.2}|", d);  // |         1.4|
println("|{:12e}|", d);   // |1.365870e+00|

int width { 12 };
int precision { 3 };
println("|{2:{0}.{1}f}|", width, precision, d); // |     1.366|
println("|{2:{0}.{1}}|", width, precision, d);  // |      1.37|
\end{cpp}

\mySamllsection{0}

è¯´æ˜ç¬¦çš„0éƒ¨åˆ†ï¼Œå¯¹äºæ•°å€¼è¦å°†é›¶æ’å…¥åˆ°æ ¼å¼åŒ–çš„å€¼ä¸­ï¼Œä»¥è¾¾åˆ°è¯´æ˜ç¬¦çš„[width]éƒ¨åˆ†æŒ‡å®šçš„æ‰€éœ€æœ€å°å®½åº¦(è§å‰é¢)ã€‚è¿™äº›é›¶æ’å…¥åˆ°æ•°å€¼çš„å‰é¢ï¼Œä½†æ˜¯åœ¨æ­£è´Ÿå·ä¹‹åï¼Œä»¥åŠåœ¨ä»»ä½•0xã€0xã€0bæˆ–0bå‰ç¼€ä¹‹åã€‚è‹¥æŒ‡å®šäº†å¯¹é½æ–¹å¼ï¼Œåˆ™å¿½ç•¥0è¯´æ˜ç¬¦ã€‚

ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­:

\begin{cpp}
int i { 42 };
println("|{:06d}|", i);   // |000042|
println("|{:+06d}|", i);  // |+00042|
println("|{:06X}|", i);   // |00002A|
println("|{:#06X}|", i);  // |0X002A|
\end{cpp}

\mySamllsection{L}

å¯é€‰çš„Lè¯´æ˜ç¬¦æ”¯æŒç‰¹å®šäºè¯­è¨€ç¯å¢ƒçš„æ ¼å¼åŒ–ã€‚æ­¤é€‰é¡¹ä»…å¯¹ç®—æœ¯ç±»å‹æœ‰æ•ˆï¼Œä¾‹å¦‚æ•´æ•°ã€æµ®ç‚¹ç±»å‹å’Œå¸ƒå°”ç±»å‹ã€‚å½“ä¸æ•´æ•°ä¸€èµ·ä½¿ç”¨æ—¶ï¼ŒLé€‰é¡¹æŒ‡å®šå¿…é¡»ä½¿ç”¨ç‰¹å®šäºè¯­è¨€ç¯å¢ƒçš„æ•°å­—ç»„åˆ†éš”ç¬¦ã€‚å¯¹äºæµ®ç‚¹ç±»å‹ï¼Œä½¿ç”¨ç‰¹å®šäºè¯­è¨€ç¯å¢ƒçš„æ•°å­—ç»„å’Œåè¿›åˆ¶åˆ†éš”ç¬¦ã€‚å¯¹äºä»¥æ–‡æœ¬å½¢å¼è¾“å‡ºçš„å¸ƒå°”ç±»å‹ï¼Œä½¿ç”¨ç‰¹å®šäºè¯­è¨€ç¯å¢ƒçš„trueå’Œfalseè¡¨ç¤ºã€‚

ä½¿ç”¨Lè¯´æ˜ç¬¦æ—¶ï¼Œå¿…é¡»å°†std::localeå®ä¾‹ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’ç»™std::format()ã€‚è¿™åªé€‚ç”¨äºformat()ï¼Œä¸é€‚ç”¨äºprint()å’Œprintln()ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨nlè¯­è¨€ç¯å¢ƒæ ¼å¼åŒ–æµ®ç‚¹æ•°çš„ç¤ºä¾‹:

\begin{cpp}
float f { 1.2f };
cout << format(std::locale{ "nl" }, "|{:Lg}|\n", f); // |1,2|
\end{cpp}

æœ¬åœ°åŒ–å°†åœ¨ç¬¬21ç« ä¸­è®¨è®ºã€‚

\CXXTwentythreeLogo{-40}{-50}

\mySubsubsection{2.2.6.}{æ ¼å¼åŒ–è½¬ä¹‰å­—ç¬¦å’Œå­—ç¬¦ä¸²}

C++23å¯ä»¥ä½¿ç”¨?ç±»å‹è¯´æ˜ç¬¦ã€‚è¿™ä¸ªç”¨ä¾‹å¹¶ä¸ç»å¸¸å‘ç”Ÿï¼Œä½†å¯¹äºæ—¥å¿—è®°å½•å’Œè°ƒè¯•å¾ˆæœ‰å¸®åŠ©ã€‚è¾“å‡ºç±»ä¼¼äºåœ¨ä»£ç ä¸­ç¼–å†™å­—ç¬¦ä¸²å’Œå­—ç¬¦å­—é¢é‡çš„æ–¹å¼:ä»¥åŒå¼•å·æˆ–å•å¼•å·å¼€å§‹å’Œç»“æŸï¼Œå¹¶ä¸”ä½¿ç”¨è½¬ä¹‰å­—ç¬¦åºåˆ—ã€‚ä¸‹è¡¨æ˜¾ç¤ºäº†ä½¿ç”¨è½¬ä¹‰æ ¼å¼æ—¶æŸäº›å­—ç¬¦çš„è¾“å‡º:

% Please add the following required packages to your document preamble:
% \usepackage{longtable}
% Note: It may be necessary to compile the document several times to get a multi-page table to line up properly
\begin{longtable}{|l|l|}
\hline
å­—ç¬¦       & è½¬ä¹‰è¾“å‡º                   \\ \hline
\endfirsthead
%
\endhead
%
æ°´å¹³åˆ¶è¡¨ç¬¦  & \textbackslash{}t                \\ \hline
æ¢è¡Œ        & \textbackslash{}n                \\ \hline
å›è½¦ & \textbackslash{}r                \\ \hline
åæ–œæ        & \textbackslash{}\textbackslash{} \\ \hline
åŒå¼•å·    & \textbackslash{}"                \\ \hline
å•å¼•å·    & \textbackslash{}'                \\ \hline
\end{longtable}

åŒå¼•å·çš„è½¬ä¹‰ä»…åœ¨è¾“å‡ºä¸ºåŒå¼•å·å­—ç¬¦ä¸²æ—¶å‘ç”Ÿï¼Œè€Œå•å¼•å·çš„è½¬ä¹‰ä»…åœ¨è¾“å‡ºä¸ºå•å¼•å·å­—ç¬¦æ—¶å‘ç”Ÿã€‚ä¸å¯è¾“å‡ºå­—ç¬¦çš„è½¬ä¹‰è¾“å‡ºä¸º\textbackslash{}u\{åå…­è¿›åˆ¶æ•°\}ã€‚

ä¸‹é¢æ˜¯ä¸€äº›ä¾‹å­:

\begin{cpp}
println("|{:?}|", "Hello\tWorld!\n");   // |Hello\tWorld!\n|
println("|{:?}|", "\"");                // |"\""|
println("|{:?}|", '\'');                // |'\''|
println("|{:?}|", '"');                 // |'"'|
\end{cpp}

\CXXTwentythreeLogo{-40}{-50}

\mySubsubsection{2.2.7.}{æ ¼å¼èŒƒå›´}

ç¬¬ 1 ç« ä»‹ç»äº†std::vectorã€arrayå’Œpairå®¹å™¨æ¥å­˜å‚¨å¤šä¸ªæ•°æ®å…ƒç´ ã€‚C++23èµ·ï¼Œå¯ä»¥ç›´æ¥æ ¼å¼åŒ–è¿™äº›å…ƒç´ çš„èŒƒå›´ã€‚å¯¹äºå¦‚vectorå’Œarrayè¿™æ ·çš„èŒƒå›´ï¼Œé»˜è®¤è¾“å‡ºç”±æ–¹æ‹¬å·åŒ…å›´ï¼Œå„ä¸ªå…ƒç´ ç”±é€—å·åˆ†éš”ã€‚è‹¥èŒƒå›´çš„å…ƒç´ æ˜¯å­—ç¬¦ä¸²ï¼Œå…¶è¾“å‡ºé»˜è®¤è¿›è¡Œè½¬ä¹‰ã€‚

èŒƒå›´çš„æ ¼å¼åŒ–å¯ä»¥é€šè¿‡åµŒå¥—æ ¼å¼è¯´æ˜ç¬¦æ¥æ§åˆ¶ã€‚ä¸€èˆ¬å½¢å¼ä¸ºï¼š

\begin{shell}
[[fill]align][width][n][range-type][:range-underlying-spec]
\end{shell}

æ–¹æ‹¬å·ä¹‹é—´çš„å†…å®¹å¯é€‰ã€‚ä¸å…¶ä»–æ ¼å¼è¯´æ˜ç¬¦ä¸€æ ·ï¼ŒfillæŒ‡å®šå¡«å……å­—ç¬¦ï¼ŒalignæŒ‡å®šè¾“å‡ºçš„å¯¹é½æ–¹å¼ï¼ŒwidthæŒ‡å®šè¾“å‡ºå­—æ®µçš„å®½åº¦ã€‚è‹¥æŒ‡å®šäº†nï¼Œè¾“å‡ºå°†ä¸åŒ…å«èŒƒå›´çš„å·¦æ‹¬å·å’Œå³æ‹¬å·ã€‚èŒƒå›´ç±»å‹å¯ä»¥æ˜¯ä»¥ä¸‹ç±»å‹:

% Please add the following required packages to your document preamble:
% \usepackage{longtable}
% Note: It may be necessary to compile the document several times to get a multi-page table to line up properly
\begin{longtable}{|l|l|}
\hline
\textbf{èŒƒå›´ç±»å‹} & \textbf{æè¿°}                                                                                                                     \\ \hline
\endfirsthead
%
\endhead
%
m &
\begin{tabular}[c]{@{}l@{}}ä»…å¯¹åŒ…å«ä¸¤ä¸ªå…ƒç´ çš„pairå’Œtupleå¯ç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç”¨åœ†æ‹¬å·æ‹¬èµ·æ¥ï¼Œå¹¶ç”¨é€—å·åˆ†\\ éš”ã€‚è‹¥æŒ‡å®šäº†mï¼Œåˆ™ä¸ç”¨æ‹¬å·åŒ…å›´ï¼Œå¹¶ä¸”ä¸¤ä¸ªå…ƒç´ ç”¨":"åˆ†éš”ã€‚\end{tabular} \\ \hline
s                   & \begin{tabular}[c]{@{}l@{}}å°†èŒƒå›´æ ¼å¼åŒ–ä¸ºå­—ç¬¦ä¸²(ä¸èƒ½ä¸næˆ–èŒƒå›´åŸºæœ¬è§„æ ¼ç»„åˆ)ã€‚\end{tabular}          \\ \hline
?s                  & \begin{tabular}[c]{@{}l@{}}å°†èŒƒå›´æ ¼å¼åŒ–ä¸ºè½¬ä¹‰å­—ç¬¦ä¸²(ä¸èƒ½ä¸næˆ–èŒƒå›´åŸºç¡€è§„èŒƒç»“åˆä½¿ç”¨)\end{tabular} \\ \hline
\end{longtable}

èŒƒå›´åŸºç¡€è§„èŒƒæ˜¯èŒƒå›´å„ä¸ªå…ƒç´ çš„å¯é€‰æ ¼å¼è¯´æ˜ç¬¦ï¼ŒèŒƒå›´è¯´æ˜ç¬¦å¯ä»¥åµŒå¥—å¤šä¸ªå±‚æ¬¡ã€‚è‹¥å…ƒç´ ä»ç„¶æ˜¯èŒƒå›´(ä¾‹å¦‚ï¼ŒåµŒå¥—vector)ï¼Œåˆ™èŒƒå›´åŸºç¡€è§„èŒƒæ˜¯å¦ä¸€ä¸ªèŒƒå›´æ ¼å¼è¯´æ˜ç¬¦ï¼Œä¾æ­¤ç±»æ¨ã€‚

æ¥çœ‹ä¸€äº›ä¾‹å­ï¼Œæ ¼å¼åŒ–vector<int>:

\begin{cpp}
vector values { 11, 22, 33 };
println("{}", values); // [11, 22, 33]
println("{:n}", values); // 11, 22, 33
\end{cpp}

è‹¥è¦æ›¿æ¢å¼€å§‹å’Œç»“æŸæ–¹æ‹¬å·ï¼Œå¯ä»¥å°†æ ¼å¼è¯´æ˜ç¬¦çš„nè¯´æ˜ç¬¦ä¸å¼€å§‹å’Œç»“æŸå­—ç¬¦ç»“åˆèµ·æ¥ã€‚ä¸‹é¢çš„ä»£ç å°†è¾“å‡ºç”¨èŠ±æ‹¬å·æ‹¬èµ·æ¥ï¼Œå¸Œæœ›åœ¨è¾“å‡ºä¸­å‡ºç°çš„å¤§æ‹¬å·éœ€è¦è½¬ä¹‰ä¸º\{\{å’Œ\}\}ã€‚

\begin{cpp}
println("{{{:n}}}", values); // {11, 22, 33}
\end{cpp}

ä¸‹é¢æä¾›äº†æ•´ä¸ªèŒƒå›´çš„æ ¼å¼è¯´æ˜ç¬¦ã€‚å¯¹äºè¿™ä¸¤ç§æƒ…å†µï¼ŒèŒƒå›´éƒ½åœ¨16ä¸ªå­—ç¬¦å®½çš„å­—æ®µçš„ä¸­å¿ƒè¾“å‡ºï¼Œå¹¶ä»¥*ä½œä¸ºå¡«å……å­—ç¬¦ã€‚å¯¹äºç¬¬äºŒä¸ªï¼ŒnæŒ‡å®šå·¦æ‹¬å·å’Œå³æ‹¬å·åº”è¯¥çœç•¥:

\begin{cpp}
println("{:*^16}", values); // **[11, 22, 33]**
println("{:*^16n}", values); // ***11, 22, 33***
\end{cpp}

ä¸‹é¢çš„ä»£ç æ²¡æœ‰ä¸ºæ•´ä¸ªèŒƒå›´æä¾›æ˜¾å¼çš„è¯´æ˜ç¬¦ï¼Œä½†æŒ‡å®šäº†å¦‚ä½•æ ¼å¼åŒ–å•ä¸ªå…ƒç´ ï¼Œå•ä¸ªå…ƒç´ è¾“å‡ºåœ¨6ä¸ªå­—ç¬¦å®½çš„å­—æ®µçš„ä¸­å¿ƒï¼Œ*ä½œä¸ºå¡«å……å­—ç¬¦:

\begin{cpp}
println("{::*^6}", values); // [**11**, **22**, **33**]
\end{cpp}

è¿™ä¹Ÿå¯ä»¥ä¸næŒ‡ç¤ºç¬¦ç»“åˆä½¿ç”¨:

\begin{cpp}
println("{:n:*^6}", values); // **11**, **22**, **33**
\end{cpp}

ä¸‹é¢æ˜¯ä¸€äº›æ ¼å¼åŒ–å­—ç¬¦ä¸²vectorçš„ç¤ºä¾‹:

\begin{cpp}
vector strings { "Hello"s, "World!\t2023"s };
println("{}", strings);     // ["Hello", "World!\t2023"]
println("{:}", strings);    // ["Hello", "World!\t2023"]
println("{::}", strings);   // [Hello, World!   2023]
println("{:n:}", strings);  // Hello, World!   2023
\end{cpp}

è‹¥æœ‰ä¸€ä¸ªå­—ç¬¦vectorï¼Œå¯ä»¥å°†å®ƒä»¬æ ¼å¼åŒ–ä¸ºå•ä¸ªå­—ç¬¦ï¼Œæˆ–è€…ä½¿ç”¨sæˆ–?sèŒƒå›´ç±»å‹å°†æ•´ä¸ªvectorè§†ä¸ºå­—ç¬¦ä¸²:

\begin{cpp}
vector chars { 'W', 'o', 'r', 'l', 'd', '\t', '!' };
println("{}", chars);       // ['W', 'o', 'r', 'l', 'd', '\t', '!']
println("{::#x}", chars);   // [0x57, 0x6f, 0x72, 0x6c, 0x64, 0x9, 0x21]
println("{:s}", chars);     // World    !
println("{:?s}", chars);    // "World\t!"
\end{cpp}

ä¸‹é¢æ˜¯ä¸€äº›è¾“å‡ºpairçš„ç¤ºä¾‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨åœ†æ‹¬å·åŒ…å›´pairï¼Œè€Œä¸æ˜¯æ–¹æ‹¬å·ï¼Œä¸¤ä¸ªå…ƒç´ ç”¨é€—å·åˆ†éš”ã€‚ä½¿ç”¨nè¯´æ˜ç¬¦å°†åˆ é™¤å·¦æ‹¬å·å’Œå³æ‹¬å·ã€‚mè¯´æ˜ç¬¦è¿˜åˆ é™¤æ‹¬å·å¹¶ç”¨":"åˆ†éš”å…ƒç´ ã€‚

\begin{cpp}
pair p { 11, 22 };
println("{}", p);     // (11, 22)
println("{:n}", p);   // 11, 22
println("{:m}", p);   // 11: 22
\end{cpp}

æœ€åï¼Œè¿™é‡Œæœ‰ä¸€äº›è¾“å‡ºåµŒå¥—vectorçš„ä¾‹å­:

\begin{cpp}
vector<vector<int>> vv { {11, 22}, {33, 44, 55} };
println("{}", vv);          // [[11, 22], [33, 44, 55]]
println("{:n}", vv);        // [11, 22], [33, 44, 55]
println("{:n:n}", vv);      // 11, 22, 33, 44, 55
println("{:n:n:*^4}", vv);  // *11*, *22*, *33*, *44*, *55*
\end{cpp}

\mySubsubsection{2.2.8.}{æ”¯æŒè‡ªå®šä¹‰ç±»å‹}

å¯ä»¥æ‰©å±•æ ¼å¼åŒ–åº“ä»¥æ·»åŠ å¯¹è‡ªå®šä¹‰ç±»å‹çš„æ”¯æŒã€‚è¿™æ¶‰åŠåˆ°ç¼–å†™std::formatterç±»æ¨¡æ¿çš„ç‰¹åŒ–ï¼Œå…¶ä¸­åŒ…å«ä¸¤ä¸ªæˆå‘˜å‡½æ•°æ¨¡æ¿:parse()å’Œformat()ã€‚æˆ‘çŸ¥é“ï¼Œåœ¨è¿™é‡Œå„ä½è¯»è€…å¯èƒ½è¿˜æ²¡æœ‰ç†è§£è¿™ä¸ªä¾‹å­ä¸­çš„æ‰€æœ‰è¯­æ³•ï¼Œå› ä¸ºå®ƒä½¿ç”¨äº†ä»¥ä¸‹æŠ€æœ¯:

\begin{itemize}
\item
constexprå‡½æ•°ï¼Œç¬¬9ç« å†…å®¹

\item
æ¨¡æ¿ç‰¹åŒ–ã€æˆå‘˜å‡½æ•°æ¨¡æ¿å’Œç®€åŒ–å‡½æ•°æ¨¡æ¿è¯­æ³•ï¼Œç¬¬12ç« å†…å®¹

\item
å¼‚å¸¸ï¼Œç¬¬14ç« å†…å®¹

\item
è¿­ä»£å™¨ï¼Œç¬¬17ç« å†…å®¹
\end{itemize}

ä¸ºäº†å®Œæ•´èµ·è§ï¼Œå¹¶è®©å„ä½ä½“éªŒä¸€ä¸‹ï¼Œæ¥çœ‹çœ‹å¦‚ä½•å®ç°è‡ªå®šä¹‰æ ¼å¼åŒ–å™¨ï¼Œå¯ä»¥å›åˆ°è¿™ä¸ªç¤ºä¾‹ã€‚

å‡è®¾æœ‰ä¸‹é¢çš„ç±»æ¥å­˜å‚¨ä¸€ä¸ªé”®å€¼å¯¹:

\begin{cpp}
class KeyValue
{
    public:
        KeyValue(string_view key, int value) : m_key { key }, m_value { value } {}

        const string& getKey() const { return m_key; }
        int getValue() const { return m_value; }
    private:
        string m_key;
        int m_value { 0 };
};
\end{cpp}

KeyValueå¯¹è±¡çš„è‡ªå®šä¹‰æ ¼å¼åŒ–ç¨‹åºï¼Œå¯ä»¥é€šè¿‡ç¼–å†™ä»¥ä¸‹ç±»æ¨¡æ¿ç‰¹åŒ–æ¥å®ç°ã€‚è¿™ä¸ªKeyValueæ ¼å¼åŒ–å™¨æ”¯æŒ:

\begin{itemize}
\item
è‡ªå®šä¹‰æ ¼å¼è¯´æ˜ç¬¦:\{:k\}åªè¾“å‡ºé”®ï¼Œ\{:v\}åªè¾“å‡ºå€¼ï¼Œ\{:b\}å’Œ\{\}åŒæ—¶è¾“å‡ºé”®å’Œå€¼ã€‚

\item
åµŒå¥—æ ¼å¼è¯´æ˜ç¬¦:ä¸ºé”®å’Œ/æˆ–å€¼æŒ‡å®šå¯é€‰æ ¼å¼ã€‚è¯­æ³•ä¸º:\{:b:KeyFormat:ValueFormat\}ã€‚

\begin{cpp}
template <>
class std::formatter<KeyValue>
{
    public:
        constexpr auto parse(auto& context)
        {
            string keyFormat, valueFormat;
            size_t numberOfParsedColons { 0 };
            auto iter { begin(context) };
            for (; iter != end(context); ++iter) {
                if (*iter == '}') { break; }

                if (numberOfParsedColons == 0) { // Parsing output type
                    switch (*iter) {
                        case 'k': case 'K': // {:k format specifier
                            m_outputType = OutputType::KeyOnly; break;
                        case 'v': case 'V': // {:v format specifier
                            m_outputType = OutputType::ValueOnly; break;
                        case 'b': case 'B': // {:b format specifier
                            m_outputType = OutputType::KeyAndValue; break;
                        case ':':
                            ++numberOfParsedColons; break;
                        default:
                            throw format_error { "Invalid KeyValue format." };
                    }
                } else if (numberOfParsedColons == 1) { // Parsing key format
                    if (*iter == ':') { ++numberOfParsedColons; }
                    else { keyFormat += *iter; }
                } else if (numberOfParsedColons == 2) { // Parsing value format
                    valueFormat += *iter;
                }
            }
            // Validate key format specifier.
            if (!keyFormat.empty()) {
                format_parse_context keyFormatterContext { keyFormat };
                m_keyFormatter.parse(keyFormatterContext);
            }
            // Validate value format specifier.
            if (!valueFormat.empty()) {
                format_parse_context valueFormatterContext { valueFormat };
                m_valueFormatter.parse(valueFormatterContext);
            }
            if (iter != end(context) && *iter != '}') {
                throw format_error { "Invalid KeyValue format." };
            }
            return iter;
        }

        auto format(const KeyValue& kv, auto& ctx) const
        {
            switch (m_outputType) {
                using enum OutputType;
                case KeyOnly:
                    ctx.advance_to(m_keyFormatter.format(kv.getKey(), ctx));
                    break;
                case ValueOnly:
                    ctx.advance_to(m_valueFormatter.format(kv.getValue(), ctx));
                    break;
                default:
                    ctx.advance_to(m_keyFormatter.format(kv.getKey(), ctx));
                    ctx.advance_to(format_to(ctx.out(), " - "));
                    ctx.advance_to(m_valueFormatter.format(kv.getValue(), ctx));
                    break;
                }
                return ctx.out();
            }
        private:
            enum class OutputType { KeyOnly, ValueOnly, KeyAndValue };
            OutputType m_outputType { OutputType::KeyAndValue };
            formatter<string> m_keyFormatter;
            formatter<int> m_valueFormatter;
};
\end{cpp}
\end{itemize}

parse()æˆå‘˜å‡½æ•°è´Ÿè´£è§£æç»™å®šçš„å­—ç¬¦èŒƒå›´[begin(context), end(context))ä¸­çš„æ ¼å¼è¯´æ˜ç¬¦ï¼Œå°†è§£æçš„ç»“æœå­˜å‚¨åœ¨formatterç±»çš„æ•°æ®æˆå‘˜ä¸­ï¼Œå¹¶è¿”å›ä¸€ä¸ªæŒ‡å‘è§£ææ ¼å¼è¯´æ˜ç¬¦å­—ç¬¦ä¸²æœ«å°¾ä¹‹åå­—ç¬¦çš„è¿­ä»£å™¨ã€‚å…¶ä¸­ä¸¤ä¸ªæ•°æ®æˆå‘˜æ˜¯m\_keyFormatterç±»å‹ä¸ºformatter<string>å’Œm\_valueFormatterç±»å‹ä¸ºformatter<int>ï¼Œåˆ†åˆ«ç”¨äºå¤„ç†æ ¼å¼è¯´æ˜ç¬¦çš„KeyFormatå’ŒValueFormatéƒ¨åˆ†ã€‚

format()æˆå‘˜å‡½æ•°æ ¹æ®parse()è§£æçš„æ ¼å¼è§„èŒƒæ ¼å¼åŒ–ç¬¬ä¸€ä¸ªå‚æ•°ç»™å®šçš„å€¼ï¼Œå°†ç»“æœå†™å…¥ctx.out()ï¼Œå¹¶è¿”å›ä¸€ä¸ªæŒ‡å‘è¾“å‡ºæœ«å°¾çš„è¿­ä»£å™¨ã€‚è¯¥å‡½æ•°ä½¿ç”¨std::format\_to()ï¼Œä¸std::format()ç±»ä¼¼ï¼Œä¸åŒä¹‹å¤„åœ¨äºå®ƒæ¥å—ä¸€ä¸ªè¾“å‡ºè¿­ä»£å™¨ï¼ŒæŒ‡ç¤ºè¾“å‡ºåº”è¯¥å†™å…¥çš„ä½ç½®ã€‚

æµ‹è¯•KeyValueæ ¼å¼åŒ–å™¨ï¼š

\begin{cpp}
const size_t len { 34 }; // Label field length
KeyValue kv { "Key 1", 255 };
println("{:>{}} {}", "Default:", len, kv);
println("{:>{}} {:k}", "Key only:", len, kv);
println("{:>{}} {:v}", "Value only:", len, kv);
println("{:>{}} {:b}", "Key and value with default format:", len, kv);
println("{:>{}} {:k:*^11}", "Key only with special format:", len, kv);
println("{:>{}} {:v::#06X}", "Value only with special format:", len, kv);
println("{:>{}} {::*^11:#06X}", "Key and value with special format:", len, kv);
try {
    auto formatted { vformat("{:cd}", make_format_args(kv)) };
    println("{}", formatted);
} catch (const format_error& caught_exception) {
    println("{}", caught_exception.what());
}
\end{cpp}

è¾“å‡ºä¸º:

\begin{shell}
                          Default: Key 1 - 255
                         Key only: Key 1
                       Value only: 255
Key and value with default format: Key 1 - 255
     Key only with special format: ***Key 1***
   Value only with special format: 0X00FF
Key and value with special format: ***Key 1*** - 0X00FF
Invalid KeyValue format.
\end{shell}

ä½œä¸ºç»ƒä¹ ï¼Œå¯ä»¥åœ¨é”®å’Œå€¼ä¹‹é—´æ·»åŠ å¯¹ä¸åŒåˆ†éš”ç¬¦çš„æ”¯æŒã€‚ä½¿ç”¨è‡ªå®šä¹‰æ ¼å¼åŒ–å™¨ï¼Œåˆ™å…·æœ‰æ— é™å¯èƒ½ï¼Œå¹¶ä¸”ä¸€åˆ‡éƒ½æ˜¯ç±»å‹å®‰å…¨çš„!



















